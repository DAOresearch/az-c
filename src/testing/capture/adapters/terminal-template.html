<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Terminal Capture</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/xterm@5.3.0/css/xterm.css"
    />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background-color: #0b0e14;
        font-family: "Monaco", "Menlo", "Consolas", "Courier New", monospace;
      }

      body {
        display: flex;
        align-items: stretch;
        justify-content: stretch;
      }

      #terminal {
        flex: 1;
        display: flex;
      }

      #terminal .xterm,
      #terminal .xterm-screen {
        width: 100% !important;
        height: 100% !important;
      }
    </style>
    <script src="https://unpkg.com/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://unpkg.com/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
  </head>
  <body>
    <div id="terminal"></div>
    <script>
      const term = new window.Terminal({
        allowProposedApi: true,
        convertEol: true,
        cursorBlink: false,
        cursorStyle: "underline",
        theme: {
          background: "#0b0e14",
          foreground: "#e5f2ff",
          cursor: "#e5f2ff",
          black: "#0b0e14",
          red: "#f7768e",
          green: "#9ece6a",
          yellow: "#e0af68",
          blue: "#7aa2f7",
          magenta: "#ad8ee6",
          cyan: "#449dab",
          white: "#e5f2ff",
        },
        fontFamily: "Monaco, Menlo, Consolas, 'Courier New', monospace",
        fontSize: 14,
        letterSpacing: 0,
        lineHeight: 1.3,
      });
      const fitAddon = new window.FitAddon.FitAddon();
      term.loadAddon(fitAddon);
      term.open(document.getElementById("terminal"));

      const fit = () => {
        try {
          fitAddon.fit();
        } catch (error) {
          console.error("Failed to fit terminal", error);
        }
      };

      fit();
      window.addEventListener("resize", fit);

      window.terminal = {
        init(cols, rows) {
          if (Number.isFinite(cols) && Number.isFinite(rows)) {
            term.resize(Math.floor(cols), Math.floor(rows));
          }
          fit();
        },
        write(data) {
          term.write(data);
        },
        clear() {
          term.clear();
          term.reset();
        },
        measure() {
          const dimensions = fitAddon.proposeDimensions();
          if (dimensions) {
            return dimensions;
          }
          return { cols: term.cols, rows: term.rows };
        },
      };
    </script>
  </body>
</html>
